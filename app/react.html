<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>AI Assistant ü§ì</title>
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <script
      src="https://unpkg.com/react@18.2.0/umd/react.development.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script
      src="https://unpkg.com/@mui/material@5.14.20/umd/material-ui.development.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://unpkg.com/@babel/standalone@latest/babel.min.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
  </head>

  <body>
    `TO USE THIS APP YOU HAVE TO BE CONNECTED TO VPN or SFU WIFI` `IF FRAME
    BELOW IS BLANK, THAT MEANS YOU ARE NOT CONNECTED` `BEFORE YOU CAN USE THE
    APP YOU HAVE TO ACCEPT PERMISSIONS BELOW ONCE` [Click
    Link](https://142.58.23.176:42000/) **Advanced>Proceed to safe...**

    <div id="root"></div>
    <script type="text/babel">
      const {
        ThemeProvider,
        CssBaseline,
        Typography,
        Button,
        TextField,
        Container,
        Box,
        Accordion,
        AccordionSummary,
        AccordionDetails,
        Rating,
        Skeleton,
      } = MaterialUI;

      // Add ExpandMore icon component for accordions
      const ExpandMoreIcon = () => React.createElement('span', {style: {fontSize: '1.2em'}}, '‚ñº');


      const WS = new WebSocket("wss://127.0.0.1:42000/stream");

      function App() {
        const [response, setResponse] = React.useState("");
        const [question, setQuestion] = React.useState("");
        const [loading, setLoading] = React.useState(false);
        const [message, setMessage] = React.useState("");
        const [rating, setRating] = React.useState(0);
        const [ws, setWs] = React.useState(null);

        React.useEffect(() => {
          WS.onmessage = (event) => {
            setLoading(false);
            setResponse(marked.parse(event.data));
          };
        }, []);

        const sendQuestion = () => {
          setLoading(true);
          setResponse("");
          WS.send(question);
        };

        const askMyProf = () => {
          setLoading(true);
          const WS = new WebSocket("wss://127.0.0.1:42000/stream");
          setWs(WS);

          WS.onmessage = (event) => {
            // Check if EOS is substring of the response
            if (event.data.includes("EOS")) {
              setLoading(false);
            } else {
              setResponse(marked.parse(event.data));
            }
          };

          // Send the question to the server
          WS.onopen = () => {
            WS.send(question);
          };
        };

        const stopStream = () => {
          if (ws) {
            setResponse("");
            ws.close();
            setLoading(false);
          }
        };

        const sendTopic = async () => {
          // setLoading(true);
          const response = await fetch(
            `https://127.0.0.1:42000/topic?query=${question}`
          );
          const data = await response.text();
          setResponse(marked.parse(data));
          //setLoading(true);
        };
        const handleRatingChange = (event, newValue) => {
          setRating(newValue);
          // Invoke a post request to the backend to update the rating along with query to post url
          const requestOptions = {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              query: question,
              rating: newValue,
              resp: setResponse,
            }),
          };
          const response = fetch(
            "https://127.0.0.1:42000/rating",
            requestOptions
          );
        };

        return (
          <Container maxWidth="md" sx={{ py: 4 }}>
            {/* Header Section */}
            <Box sx={{ textAlign: 'center', mb: 4 }}>
              <Typography variant="h3" component="h1" sx={{ 
                fontWeight: 700, 
                background: 'linear-gradient(45deg, #1976d2, #42a5f5)',
                backgroundClip: 'text',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent',
                mb: 2
              }}>
                CMPT 295 AI Assistant
              </Typography>
              <Typography variant="h6" color="text.secondary" sx={{ mb: 3 }}>
                Your intelligent coding companion for computer systems and assembly
              </Typography>
            </Box>

            {/* Collapsible Info Sections */}
            <Box sx={{ mb: 4 }}>
              <Accordion sx={{ mb: 1, borderRadius: 2, '&:before': { display: 'none' } }}>
                <AccordionSummary
                  expandIcon={React.createElement(ExpandMoreIcon)}
                  sx={{
                    backgroundColor: "#f5f5f5",
                    borderRadius: 2,
                    '&:hover': { backgroundColor: '#e3f2fd' }
                  }}
                >
                  <Typography variant="h6" fontWeight={600}>üí° About this AI Bot</Typography>
                </AccordionSummary>
                <AccordionDetails sx={{ p: 3 }}>
                  <Typography component="div" variant="body1" lineHeight={1.6}>
                    <p>
                      We're excited to launch a pilot program to explore how AI can enhance your learning experience. 
                      Think of it not as a substitute for asking questions in class or to your instructor, but as a 
                      handy tool to deepen your understanding of the concepts we cover at your own convenience.
                    </p>
                    <Box component="div" sx={{ my: 2 }}>
                      <Typography variant="subtitle1" fontWeight={600} gutterBottom>Two main features:</Typography>
                      <Box component="ul" sx={{ pl: 2 }}>
                        <li>Ask for a specific topic and get links to exact moments in relevant videos from our database</li>
                        <li>Use the Q&A feature for detailed explanations and code examples</li>
                      </Box>
                    </Box>
                    <Typography variant="body2" color="text.secondary">
                      Please note: While the app strives to provide accurate information, it relies on AI algorithms 
                      and may not always be perfect. Please rate answers and always cross-verify critical information.
                    </Typography>
                  </Typography>
                </AccordionDetails>
              </Accordion>

              <Accordion sx={{ mb: 1, borderRadius: 2, '&:before': { display: 'none' } }}>
                <AccordionSummary
                  expandIcon={React.createElement(ExpandMoreIcon)}
                  sx={{
                    backgroundColor: "#f5f5f5",
                    borderRadius: 2,
                    '&:hover': { backgroundColor: '#e3f2fd' }
                  }}
                >
                  <Typography variant="h6" fontWeight={600}>üìù Example Questions</Typography>
                </AccordionSummary>
                <AccordionDetails sx={{ p: 3 }}>
                  <Box component="div">
                    <Typography variant="body1" component="div" sx={{ fontFamily: 'monospace', backgroundColor: '#f8f9fa', p: 2, borderRadius: 1, mb: 2 }}>
                      ‚Ä¢ How to generate the address for a nested array element array[i][j]?<br/>
                      ‚Ä¢ What are the fields of R-type instruction in RISC-V?<br/>
                      ‚Ä¢ What are s and n in gdb?<br/>
                      ‚Ä¢ Write assembly code to implement a for loop<br/>
                      ‚Ä¢ Explain pointer arithmetic in C with examples
                    </Typography>
                  </Box>
                </AccordionDetails>
              </Accordion>

              <Accordion sx={{ borderRadius: 2, '&:before': { display: 'none' } }}>
                <AccordionSummary
                  expandIcon={React.createElement(ExpandMoreIcon)}
                  sx={{
                    backgroundColor: "#f5f5f5",
                    borderRadius: 2,
                    '&:hover': { backgroundColor: '#e3f2fd' }
                  }}
                >
                  <Typography variant="h6" fontWeight={600}>üìö Usage Guidelines</Typography>
                </AccordionSummary>
                <AccordionDetails sx={{ p: 3 }}>
                  <Typography component="div" variant="body1" lineHeight={1.6}>
                    <Box component="ul" sx={{ pl: 2, '& li': { mb: 1 } }}>
                      <li><strong>üß† Understand Its Limits:</strong> The AI is smart but not perfect. Always double-check important answers.</li>
                      <li><strong>üí° Get Examples:</strong> Ask for assembly instructions, pointer manipulation, or code examples.</li>
                      <li><strong>üôã Ask Questions:</strong> Get detailed explanations about RISC-V instructions or design features.</li>
                      <li><strong>üìö Study Aid:</strong> Use for quizzes and labs, following course rules.</li>
                      <li><strong>‚úÖ Programming Assignments:</strong> Check when it's appropriate to use the bot.</li>
                      <li><strong>‚ùå Exams:</strong> Not allowed during midterms and finals.</li>
                    </Box>
                  </Typography>
                </AccordionDetails>
              </Accordion>
            </Box>

            {/* Main Chat Interface */}
            <Box sx={{ 
              backgroundColor: 'white', 
              borderRadius: 3, 
              boxShadow: '0 4px 20px rgba(0,0,0,0.1)',
              border: '1px solid #e0e0e0',
              p: 3,
              mb: 3
            }}>
              {/* Input Section */}
              <Box sx={{ mb: 3 }}>
                <Typography variant="h6" gutterBottom fontWeight={600}>
                  Ask your question
                </Typography>
                <TextField
                  fullWidth
                  multiline
                  minRows={6}
                  maxRows={12}
                  placeholder="Ask me anything about CMPT 295... 

Examples:
‚Ä¢ Explain how function calls work in RISC-V
‚Ä¢ Write assembly code for a simple loop
‚Ä¢ How does memory allocation work?
‚Ä¢ Debug this C pointer code: int *ptr = &array[0];"
                  variant="outlined"
                  value={question}
                  disabled={loading}
                  onChange={(e) => setQuestion(e.target.value)}
                  sx={{
                    '& .MuiOutlinedInput-root': {
                      borderRadius: 2,
                      fontSize: '16px',
                      lineHeight: 1.6,
                      fontFamily: '"JetBrains Mono", "Consolas", "Monaco", monospace',
                      '&:hover fieldset': {
                        borderColor: '#1976d2',
                      },
                      '&.Mui-focused fieldset': {
                        borderColor: '#1976d2',
                        borderWidth: 2,
                      }
                    },
                    '& .MuiInputBase-input': {
                      padding: '16px',
                    }
                  }}
                />
              </Box>

              {/* Action Buttons */}
              <Box sx={{ display: 'flex', gap: 2, flexWrap: 'wrap' }}>
                <Button
                  variant="contained"
                  size="large"
                  disabled={loading || !question.trim()}
                  onClick={sendTopic}
                  sx={{
                    borderRadius: 2,
                    px: 4,
                    py: 1.5,
                    fontSize: '16px',
                    fontWeight: 600,
                    background: 'linear-gradient(45deg, #2196F3 30%, #21CBF3 90%)',
                    boxShadow: '0 3px 10px rgba(33, 150, 243, 0.3)',
                    '&:hover': {
                      background: 'linear-gradient(45deg, #1976D2 30%, #1CB5E0 90%)',
                      transform: 'translateY(-1px)',
                      boxShadow: '0 6px 20px rgba(33, 150, 243, 0.4)',
                    },
                    transition: 'all 0.2s ease-in-out'
                  }}
                >
                  üîç Search Topics
                </Button>
                
                <Button
                  variant="contained"
                  size="large"
                  disabled={!question.trim()}
                  onClick={loading ? stopStream : askMyProf}
                  sx={{
                    borderRadius: 2,
                    px: 4,
                    py: 1.5,
                    fontSize: '16px',
                    fontWeight: 600,
                    background: loading 
                      ? 'linear-gradient(45deg, #f44336 30%, #ff5722 90%)'
                      : 'linear-gradient(45deg, #4caf50 30%, #66bb6a 90%)',
                    boxShadow: loading 
                      ? '0 3px 10px rgba(244, 67, 54, 0.3)'
                      : '0 3px 10px rgba(76, 175, 80, 0.3)',
                    '&:hover': {
                      background: loading
                        ? 'linear-gradient(45deg, #d32f2f 30%, #f44336 90%)'
                        : 'linear-gradient(45deg, #388e3c 30%, #4caf50 90%)',
                      transform: 'translateY(-1px)',
                      boxShadow: loading
                        ? '0 6px 20px rgba(244, 67, 54, 0.4)'
                        : '0 6px 20px rgba(76, 175, 80, 0.4)',
                    },
                    transition: 'all 0.2s ease-in-out'
                  }}
                >
                  {loading ? "‚èπÔ∏è Stop" : "ü§ñ Ask 295 AI"}
                </Button>
              </Box>
            </Box>

            {/* Response Section */}
            {(response || loading) && (
              <Box sx={{ 
                backgroundColor: 'white', 
                borderRadius: 3, 
                boxShadow: '0 4px 20px rgba(0,0,0,0.1)',
                border: '1px solid #e0e0e0',
                p: 3,
                mb: 3
              }}>
                <Typography variant="h6" gutterBottom fontWeight={600}>
                  Response
                </Typography>
                
                {loading && !response && (
                  <Box sx={{ py: 3 }}>
                    <Skeleton variant="text" height={30} sx={{ mb: 1 }} />
                    <Skeleton variant="text" height={30} animation="wave" sx={{ mb: 1 }} />
                    <Skeleton variant="text" height={30} sx={{ mb: 1 }} />
                    <Skeleton variant="rectangular" height={100} sx={{ borderRadius: 1 }} />
                  </Box>
                )}
                
                {response && (
                  <Box sx={{
                    '& pre': {
                      backgroundColor: '#f8f9fa',
                      padding: '16px',
                      borderRadius: '8px',
                      overflow: 'auto',
                      fontSize: '14px',
                      fontFamily: '"JetBrains Mono", "Consolas", "Monaco", monospace',
                    },
                    '& code': {
                      backgroundColor: '#f1f3f4',
                      padding: '2px 6px',
                      borderRadius: '4px',
                      fontSize: '14px',
                      fontFamily: '"JetBrains Mono", "Consolas", "Monaco", monospace',
                    },
                    '& blockquote': {
                      borderLeft: '4px solid #1976d2',
                      margin: '16px 0',
                      padding: '8px 16px',
                      backgroundColor: '#f8f9fa',
                      fontStyle: 'italic',
                    }
                  }}>
                    <Typography 
                      component="div" 
                      dangerouslySetInnerHTML={{ __html: response }}
                      sx={{ lineHeight: 1.6 }}
                    />
                  </Box>
                )}
                
                {/* Rating Section */}
                {response && (
                  <Box sx={{ mt: 3, pt: 3, borderTop: '1px solid #e0e0e0' }}>
                    <Typography variant="subtitle1" gutterBottom fontWeight={600}>
                      Rate this response:
                    </Typography>
                    <Rating
                      value={rating}
                      onChange={handleRatingChange}
                      size="large"
                      sx={{ '& .MuiRating-iconFilled': { color: '#ff6d00' } }}
                    />
                  </Box>
                )}
              </Box>
            )}

            {/* Footer */}
            <Box sx={{ textAlign: 'center', mt: 4, py: 2 }}>
              <Typography variant="body2" color="text.secondary">
                Developed by Arrvindh Shriraman ‚Ä¢ CMPT 295 ‚Ä¢ SFU
              </Typography>
            </Box>
          </Container>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
